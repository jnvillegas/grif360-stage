<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiencia Ford 360</title>
	<link rel="shortcut icon" href="favicon.png">
	<script src="https://aframe.io/aframe/dist/aframe-master.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@simondmc/popup-js@1.4.2/popup.min.js"></script>
	<script src="https://morandd.github.io/aframe-multitouch-look-controls/multitouch-look-controls.js"></script>

</head>
<style>
#banner{	
	height: 350px;
	width: 80px;
	position:absolute;
	z-index: 100000; 
	top: 40%;
	right: 0px;
}

#zoomoutbutton{
	background-image: url("zoom_out.png");	
}

#zoominbutton{
	background-image: url("zoom_in.png");
}

#fullscreenbutton{
	background-image: url("fullscreen.png");
}

#vrbutton{
	background-image: url("modovr.png");
}

.controlbutton{
	width: 50px;
	height: 50px;
	background-repeat: no-repeat;
	background-position: center;
	background-size: cover;
	opacity: 0.5;
	transition: 0.3s;
	margin-bottom: 20px;	
}

.controlbutton:hover{
	width: 70px;
	height: 70px;
}

.a-enter-vr-button {display:none;}
</style>
<body>
		<div id="banner">
			<div class="controlbutton"
				 id="zoominbutton"
				 onclick="zoomIn(true)">
		    </div>
			
			<div class="controlbutton"
				 id="zoomoutbutton"
				 onclick="zoomIn(false)">				 
		    </div>
			
			<div class="controlbutton"
				 id="fullscreenbutton"
				 onclick="setFullscreen()">				 
		    </div>
			
			<div class="controlbutton"
				 id="vrbutton"
				 onclick="setVR()">				 
		    </div>
			
		</div>
		<a-scene id="escena" ajustarposicion>  
		
			<a-assets>    
				<img id="multimedia" src="Ford-Ranger-multimedia.jpg">
				<img id="asientos" src="ford-ranger-asientos.jpg">
				<img id="cerrar" src="boton-cerrar.png">
				<img id="diamante" src="diamante-texture.jpg">
				<img id="plus" src="plus.png">
				<img id="zoomin" src="zoom_in.png">
				<img id="zoomout" src="zoom_out.png">
				<img id="fullscreen" src="fullscreen.png">
				<img id="gafas" src="gafas_white.png">
				<img id="circulo" src="circle.png">
				<img id="vistaConductor" src="conductor.jpg">
				<img id="vistaAcompaniante" src="acompaniante.jpg">
				<img id="vistaAtrasDerecha" src="atras_derecha.jpg">
				<img id="vistaAtrasIzquierda" src="atras_izquierda.jpg">
				<img id="vistaCaja" src="caja.jpg">
				<img id="playvideo" src="playvideo.jpg">
				<video id="ranger_video" width="90%" src="video.mp4"></video>
			</a-assets>
			
			<a-sky id="cielo" src="" 
				   rotation="0 90 0" 
				   material="opacity: 1; transparent:true"
				   animation__fade_in="property: material.opacity; from: 0; to: 1; dur: 1000; startEvents: fadein"
				   animation__fade_out="property: material.opacity; from: 1; to: 0; dur: 1000; startEvents: fadeout"
			></a-sky>
							 
			<a-camera id="camara" camera look-controls wasd-controls="enabled: false" rotate-on-keyboard>
				<a-entity position="0 0 -1" 
						  id="cursor"						  
						  raycaster="objects: .objeto"						  
						  material="shader:flat"> </a-entity>
						  <!--a-entity class="objeto" 
									id="zoominbutton"
									clickeable
									geometry="primitive: circle; radius:0.075;" 
									animation__scale="property: scale; to: 1.5 1.5 1.5; dur: 200; startEvents: mouseenter"
									animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave" 
									position="0.8 0.1 -1" 
									material="opacity: 0.5; transparent: true; shader: flat; src: #zoomin; side: double" ></a-entity>
						  <a-entity class="objeto"
									id="zoomoutbutton"
									clickeable
									geometry="primitive: circle; radius:0.075;" 
									animation__scale="property: scale; to: 1.5 1.5 1.5; dur: 200; startEvents: mouseenter"
									animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
									position="0.8 -0.1 -1" 
									material="opacity: 0.5; transparent: true; shader: flat; src: #zoomout; side: double"></a-entity>			
   					      <a-entity class="objeto"
									id="fullscreenbutton"
									clickeable
									geometry="primitive: plane; width: 0.15; height: 0.15;" 
									animation__scale="property: scale; to: 1.5 1.5 1.5; dur: 200; startEvents: mouseenter"
									animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
									position="0.8 -0.3 -1" 
									material="opacity: 0.5; transparent: true; shader: flat; src: #fullscreen; side: double"></a-entity-->			
														
			</a-camera>			
			
			<a-mixin id="msg-button" 
					 geometry="primitive: circle; radius:2;" 
					 animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					 animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"					 
					 material="color: #66CCFF; opacity: 0.5; transparent: true; shader: flat; src: #plus;"					  
					 clickeable
					 > 
			</a-mixin>
			
			<a-mixin id="view-button" 
					 geometry="primitive: circle; radius:5;"			  					 
					 material="opacity: 1; transparent:true; shader: flat; src: #circulo; side: double"
					 clickeable					 
					 
					 > 		
				 
			</a-mixin>
			
			
			 
			<!--a-entity rotation="90 0 0">
			<a-text value="¡Hola, mundo!"
						      align="center"
							  width="6"
							  position="0 10 0"
							  color="red"							  
							  scale="2 2 2"></a-text>
			<a-entity mixin="view-button"
					  id="circlebton"
					  class="objeto"
					  position="0 -5 -15">					  	
			</a-entity>
			</a-entity-->
			
			<a-entity geometry="primitive: circle; radius:3;" 
					  animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					  animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
					  position="-1 -1 0" 
					  material="transparent: true; shader: flat; src: #gafas; side: double"					  
					  class="objeto"
					  rotation="0 -100 0"
					  clickeable				
					  animation="property: rotation; dur:3000; to: 0 360 0; easing:linear; loop:true"	  
					  id="asientoViewAction"
					  > 
			</a-entity>
			
			<a-entity geometry="primitive: circle; radius:3;" 
					  animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					  animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
					  position="-1 -10 0" 
					  material="transparent: true; shader: flat; src: #gafas; side: double"					  
					  class="objeto"
					  rotation="0 -100 0"
					  clickeable				
					  animation="property: rotation; dur:3000; to: 0 360 0; easing:linear; loop:true"	  
					  id="conductorViewAction"
					  > 
			</a-entity>
			
			<a-entity geometry="primitive: circle; radius:3;" 
					  animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					  animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
					  position="-1 -10 0" 
					  material="transparent: true; shader: flat; src: #gafas; side: double"					  
					  class="objeto"
					  rotation="0 -100 0"
					  clickeable				
					  animation="property: rotation; dur:3000; to: 0 360 0; easing:linear; loop:true"	  
					  id="cajaViewAction"
					  > 
			</a-entity>
			
			<a-entity geometry="primitive: circle; radius:3;" 
					  animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					  animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
					  position="-1 -10 0" 
					  material="transparent: true; shader: flat; src: #gafas; side: double"					  
					  class="objeto"
					  rotation="0 -100 0"
					  clickeable				
					  animation="property: rotation; dur:3000; to: 0 360 0; easing:linear; loop:true"	  
					  id="atrasViewAction"
					  > 
			</a-entity>
			
			<a-entity geometry="primitive: circle; radius:3;" 
					  animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					  animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
					  position="-1 -10 0" 
					  material="transparent: true; shader: flat; src: #gafas; side: double"					  
					  class="objeto"
					  rotation="0 -100 0"
					  clickeable				
					  animation="property: rotation; dur:3000; to: 0 360 0; easing:linear; loop:true"	  
					  id="atrasIzquierdaViewAction"
					  > 
			</a-entity>

			<!--a-entity mixin="msg-button"
					  position="70 -80 -10" 					  
					  class="objeto"
					  rotation="0 -120 0"					  					  
					  id="asientoAction"
					  > 
			</a-entity-->
			
			<a-video id="player" 
					 src="#ranger_video" 
					 width="32" 
					 height="18" 
					 position="1.9 2.9 -20" 
					 rotation="0 0 0" 
					 visible="false"
					 border='sides: 4; radius: 25; wall: #rail;'>
			</a-video>
			
			
			<a-entity geometry="primitive: circle; radius:1;" 
					  animation__scale="property: scale; to: 2.2 2.2 2.2; dur: 200; startEvents: mouseenter"
					  animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
					  position="1 -3 -9" 	
					  material="color: #66CCFF; opacity: 0.5; transparent: true; shader: flat; src: #playvideo;"					  
					  class="objeto"
					  rotation="0 0 0"
					  clickeable					  
					  id="playvideobutton"
					  border='sides: 4; radius: 25; wall: #rail;'
					  > 
			</a-entity>

			
			<a-entity position="18 -10 -22" 
					  rotation="0 0 0"
					  mixin="msg-button"
					  id="pantallaAction"
					  class="objeto"
					  geometry="primitive: circle; radius:0.2;"
					  >
			</a-entity>			
			
			
			
		</a-scene>	
</body>
<script>
var cursor = document.getElementById('cursor');
var camara = document.getElementById('camara');
var cielo = document.getElementById('cielo');
var escena = document.getElementById('escena');
var isVR = false;

document.querySelector('a-scene').addEventListener('enter-vr', function () {
   isVR = true;
});

document.querySelector('a-scene').addEventListener('exit-vr', function () {
   isVR = false;
});



var elementos = [
				  {escena:'#vistaConductor',
				   inicio: {x:0, y:0, z:0},
				   acciones: [{id:'atrasViewAction', x: 70, y: -40, z: 90 },//ready		  
							  {id:'asientoViewAction', x: 60, y: -35, z: 10 },//ready
							  {id:'cajaViewAction',  x: 50, y: 20, z: 120 }, //ready
							  {id:'pantallaAction', x: 4.5, y: -1, z: -4 },//ready
							  //{id:'asientoAction', x:60000, y:-60, z:60 },
							  {id:'conductorViewAction', x:1000, y:0, z:0 }, //ready
							  {id:'atrasIzquierdaViewAction', x:-40000, y: 5, z: 90 }, 
							 ],
				  },
				  {escena:'#vistaAcompaniante',
				   inicio: {x:0, y:0, z:0},
				   acciones: [{id:'asientoViewAction', x:-10005, y:-40, z:-30, },
							  //{id:'asientoAction', x:70000, y:-80, z:-10, },
							  {id:'pantallaAction', x:10008, y:-10, z:-22, },
							  {id:'atrasViewAction', x:4.5, y:-1, z:20 },
							  {id:'cajaViewAction', x:-40, y: 5, z: 90 }, 
							  {id:'atrasIzquierdaViewAction', x:-45, y: -40, z: 50 }, 
							  {id:'conductorViewAction', x:-30, y:-20, z: 0 },//readty
							 ]
				  },
				  {escena:'#vistaAtrasDerecha',
				   inicio: {x:0, y:75, z:0},
				   acciones: [{id:'asientoViewAction', x:-50000, y:-40, z:-30, },
							  //{id:'asientoAction', x:70000, y:-80, z:-10, },
							  {id:'pantallaAction', x:1800000, y:-10, z:-22, },
							  {id:'atrasViewAction', x:10000, y:-1, z:10 },
							  {id:'cajaViewAction', x:-20, y: 3, z:40 }, 
							  {id:'conductorViewAction', x: -40, y:-30, z:-55 }, //ready
							  {id:'atrasIzquierdaViewAction', x: -60, y:-55, z:-5 },
							 ]
				  },
				  {escena:'#vistaAtrasIzquierda',
				   inicio: {x:0, y:75, z:0},
				   acciones: [{id:'conductorViewAction', x:-50000, y:-40, z:-30, },
							  //{id:'asientoAction', x:70000, y:-80, z:-10, },
							  {id:'pantallaAction', x:1800000, y:-10, z:-22, },
							  {id:'atrasViewAction', x: 60, y:-55, z:10 },
							  {id:'cajaViewAction', x:30, y: 3, z:40 }, 
							  {id:'asientoViewAction', x: 55, y:-50, z:-70 }, //ready
							  {id:'atrasIzquierdaViewAction', x:-45000, y: -40, z: 50 },
							 ]
				  },				  
				  {escena:'#vistaCaja',
				   inicio: {x:0, y:160, z:0}, //ready
				   acciones: [{id:'asientoViewAction', x:-5000, y:-40, z:-30, },
							  //{id:'asientoAction', x:7000, y:-80, z:-10, },
							  //{id:'pantallaAction', x:1800, y:-10, z:-22, },
							  {id:'atrasViewAction', x:0, y:-8, z: 40 },
							  {id:'cajaViewAction', x:4000.5, y:-1, z:-4 }, 							  
							  {id:'atrasIzquierdaViewAction', x:-40000, y: 5, z: 90 }, 
							  {id:'conductorViewAction', x:1000, y:0, z:0 }, //ready
							 ]
				  },
				 ];

if (!AFRAME.utils.device.isMobile()){
 cursor.setAttribute('cursor', 'rayOrigin: mouse; fuse: true; fuseTimeout: 100');
 let vrbutton = document.getElementById('vrbutton');
 vrbutton.style.display = 'none';
}
else{
 cursor.setAttribute('cursor', 'fuse: true; fuseTimeout: 100');
 cursor.setAttribute('geometry', 'primitive: ring; radiusInner: 0.02; radiusOuter: 0.03');
}

const setVR = () => {
	escena.enterVR();
}

const setFullscreen = () => {
	if (!document.fullscreenElement)
		document.documentElement.requestFullscreen();
	else
		document.exitFullscreen();
}

const zoomIn = (zoomin) => {

	let objCamara = camara.getAttribute('camera');
	
	//console.log('zoom after', objCamara.zoom)
	
	objCamara.zoom += 0.1 * (zoomin?1:-1);
	if (objCamara.zoom <= 1) objCamara.zoom = 1;
	if (objCamara.zoom >= 5) objCamara.zoom = 5;
	//console.log('zoom after', objCamara.zoom)
	
	camara.setAttribute('camera', objCamara);
}

const changeView = (vista) => {
	let src = cielo.getAttribute('src');
	
	cielo.emit('fadeout');

    setTimeout(function() {
          
		
		
	let escena = elementos.find(x => x.escena == vista);
	var controls = camara.components['look-controls'];			
	if (escena){
		if (controls){
			controls.pitchObject.rotation.x = escena.inicio.x;
			controls.yawObject.rotation.y = escena.inicio.y;
		}
		
		escena.acciones.forEach(e => {
				let elemento = document.getElementById(e.id);
				
				elemento.setAttribute('position', `${e.x} ${e.y} ${e.z}`);
		})
	}
	cielo.setAttribute('src', vista);              
		  cielo.emit('fadein');
    }, 1000); 

}

const myPopup = (title, content, funcion = () => {}) => {

			return new Popup({
								id: "my-popup",
								title: title,
								content: content,
								hideCallback: funcion,
							 });
}

const playVideo = () => {
	const videoEl = document.querySelector('#ranger_video');
	const reproductor = document.querySelector('#player');
	videoEl.currentTime = 0;
	
			console.log('popppp', document.getElementsByClassName('popup my-popup'));
	let popups = document.getElementsByClassName('popup my-popup');
	
	if (!popups.length){//videoEl.paused){
		let div = document.createElement('div');		
		
		if (!isVR){		
			div.appendChild(videoEl);
			videoEl.setAttribute('controls', '');
			videoEl.setAttribute('autoplay', '');
			let popup = myPopup('Nueva Ford Ranger', div.outerHTML, playVideo);
			popup.show();
		}else {				
			reproductor.setAttribute("visible",true);
		}
		videoEl.play();
	}
	else{
		videoEl.pause();
		Array.from(popups).forEach(p => p.remove());
		reproductor.setAttribute("visible",false);
	}
	
}

changeView('#vistaConductor');



	AFRAME.registerComponent('clickeable', {
		init: function(){
			this.el.addEventListener('click', () => {
				switch (this.el.id){
					case 'pantallaAction': myPopup('Tecnologia inteligente', 'La Nueva Ranger se destaca por su tencnologia innovadora, incorporando una pantalla LED multitactil de 12 pulgadas con alta definición y un panel de instrumentos LED de 12,4 pulgadas').show(); break;
					case 'asientoAction': myPopup('Comodidad, Soporte en Asientos', 'La Nueva Ranger cuenta con asientos con ajustes eléctricos o manuales para el conductor y el pasajero, soporte lumbar, opciones de tapicería de alta calidad y tecnologías de calefacción y ventilación para mayor comodidad en diversas condiciones climáticas.').show(); break;
					case 'asientoViewAction': changeView('#vistaAcompaniante'); break;
					case 'conductorViewAction': changeView('#vistaConductor'); break;
					case 'cajaViewAction': changeView('#vistaCaja'); break;
					case 'atrasViewAction': changeView('#vistaAtrasDerecha'); break;
					case 'atrasIzquierdaViewAction': changeView('#vistaAtrasIzquierda'); break;
					case 'zoominbutton': zoomIn(true); break;
					case 'zoomoutbutton': zoomIn(false); break;
					case 'fullscreenbutton': setFullscreen(); break;
					case 'playvideobutton': playVideo(); break;
					
				}
				
			});
		}
	})
	
	AFRAME.registerComponent('ajustarposicion', {
        init: function () {
          // Llamar a la función para ajustar la posición cuando la página se carga
          this.ajustarPosicion();
          // Registrar un manejador de eventos para redimensionar la ventana
          window.addEventListener('resize', this.ajustarPosicion.bind(this));
        },
        ajustarPosicion: function () {
          // Obtener el ancho de la ventana
          /*var anchoVentana = window.innerWidth;
		  var a = anchoVentana / 1000;
		  console.log(a);
		  let zoominButton = document.getElementById('zoominbutton');
		  let zoomoutButton = document.getElementById('zoomoutbutton');
		  let fullScreenButton = document.getElementById('fullscreenbutton');
          
          zoominButton.object3D.position.x = a-0.2;
		  zoomoutButton.object3D.position.x = a-0.2;
		  fullscreenbutton.object3D.position.x = a-0.2;*/
		  /*setAttribute('position', {
            x: 1,  // Puedes ajustar esto según tus necesidades
            y: 0.1,
            z: -1
          });*/
        }
      });
	  
	const calcularDistancia = (a, b) => {
		const dx = a.clientX - b.clientX;
		const dy = a.clientY - b.clientY;
		return Math.sqrt(dx * dx + dy * dy);
	}

	  
	AFRAME.registerComponent('rotate-on-keyboard', {
        init: function () {
          this.rotationSpeed = 0.01;
          this.rotateLeft = false;
          this.rotateRight = false;
		  this.distancia = 0;
		  this.puntoInicial = {clientX:0, clientY:0};
		  
		  window.addEventListener("wheel", (event) => {
			let delta = event.deltaY || event.detail || event.wheelDelta;
			zoomIn(delta < 0);
			
		  });


		  window.addEventListener('touchstart', (event) => { 
			this.distancia = 0;			
			let toques = Array.from(event.touches);
			if (toques.length > 1){
				this.distancia = calcularDistancia(toques[0], toques[1]);
				console.log('toques iniciales', toques.length);
			}else if (toques.length == 1){
				this.puntoInicial = {clientX: toques[0].clientX, clientY: toques[0].clientY}
				console.log('this.puntoInicial', this.puntoInicial);
			}
		  });
		  
		  
		  window.addEventListener('touchmove', (event) => { 
		  
			let toques = Array.from(event.touches);
			if (toques.length > 1){
				let esAcercamiento = this.distancia < calcularDistancia(toques[0], toques[1]);
				zoomIn(esAcercamiento);
				console.log("distancia", esAcercamiento);
			}/*else if (toques.length == 1){				
				if (toques[0].clientY > window.innerHeight/2)
					this.el.components['look-controls'].pitchObject.rotation.x -= this.rotationSpeed;
				else
					this.el.components['look-controls'].pitchObject.rotation.x += this.rotationSpeed;
			}*/
		  });
		  //window.addEventListener('touchend', function handleTouchEnd(event) { console.log("Touch End:", event.touches); });

		  
          window.addEventListener('keydown', (e) => {
		  
            if (e.key === 'ArrowLeft') {				
				this.el.components['look-controls'].yawObject.rotation.y += this.rotationSpeed;
            } else if (e.key === 'ArrowRight') {
              this.el.components['look-controls'].yawObject.rotation.y -= this.rotationSpeed;
            } else if (e.key === 'ArrowUp') {
			  this.el.components['look-controls'].pitchObject.rotation.x += this.rotationSpeed;
			} else if (e.key === 'ArrowDown') {
			  this.el.components['look-controls'].pitchObject.rotation.x -= this.rotationSpeed;
			}
          });

          window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') {
              this.rotateLeft = false;
            } else if (e.key === 'ArrowRight') {
              this.rotateRight = false;
            }
          });
        },

        tick: function (time, timeDelta) {
          // Rotación continua si las teclas están presionadas
          /*if (this.rotateLeft) {
            this.el.object3D.rotation.x += Math.PI;
          } else if (this.rotateRight) {
            this.el.object3D.rotation.y -= this.rotationSpeed * timeDelta / 1000;
          }*/
        }
      });
</script>

</html>
